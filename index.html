<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Style Cleaner - Clear HTML Styles</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 24px;
      color: #333;
      background: #f8f9fa;
    }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 8px;
      color: #1a1a1a;
    }

    .subtitle {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .panel {
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
    }

    .panel-label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: #555;
      margin-bottom: 8px;
    }

    .panel-row {
      display: flex;
      gap: 12px;
      align-items: stretch;
      min-height: 200px;
    }

    @media (max-width: 720px) {
      .panel-row {
        flex-direction: column;
      }
    }

    .panel-half {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
    }

    .panel-half .label-tab {
      font-size: 0.75rem;
      font-weight: 600;
      color: #888;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    textarea {
      width: 100%;
      flex: 1;
      min-height: 160px;
      padding: 12px;
      font-family: ui-monospace, "Cascadia Code", "Source Code Pro", Menlo, monospace;
      font-size: 13px;
      line-height: 1.5;
      border: 1px solid #ddd;
      border-radius: 6px;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: #4a9eff;
      box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
    }

    .preview-wrap {
      flex: 1;
      min-height: 160px;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
      background: #fff;
    }

    .preview-wrap iframe {
      width: 100%;
      height: 100%;
      min-height: 160px;
      border: none;
      display: block;
    }

    #output {
      background: #fafafa;
      color: #333;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin: 16px 0;
    }

    button {
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.15s;
    }

    .btn-primary {
      background: #4a9eff;
      color: #fff;
    }

    .btn-primary:hover {
      background: #3a8eef;
    }

    .btn-secondary {
      background: #e8e8e8;
      color: #333;
    }

    .btn-secondary:hover {
      background: #ddd;
    }

    .btn-secondary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    label.checkbox-wrap {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #555;
      cursor: pointer;
    }

    label.checkbox-wrap input {
      width: 18px;
      height: 18px;
    }

    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(80px);
      padding: 10px 20px;
      background: #2d2d2d;
      color: #fff;
      border-radius: 8px;
      font-size: 14px;
      opacity: 0;
      transition: transform 0.25s, opacity 0.25s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>

<body>

  <h1>Style Cleaner</h1>
  <p class="subtitle">Paste HTML source above, click to clear inline styles and unsafe attributes, then copy the result.</p>

  <div class="panel">
    <span class="panel-label">Input – HTML source to clean</span>
    <div class="panel-row">
      <div class="panel-half">
        <span class="label-tab">Source</span>
        <textarea id="input" placeholder="Paste your HTML here..."></textarea>
      </div>
      <div class="panel-half">
        <span class="label-tab">Preview</span>
        <div class="preview-wrap">
          <iframe id="inputPreview" title="Input preview" sandbox="allow-same-origin"></iframe>
        </div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button type="button" class="btn-primary" id="btnClear">Clear Style</button>
    <label class="checkbox-wrap">
      <input type="checkbox" id="keepTableStyle" checked />
      Keep table styles (border/color/width)
    </label>
  </div>

  <div class="panel">
    <span class="panel-label">Output – cleaned HTML</span>
    <div class="panel-row">
      <div class="panel-half">
        <span class="label-tab">Source</span>
        <textarea id="output" readonly placeholder="Result will appear here after clearing..."></textarea>
      </div>
      <div class="panel-half">
        <span class="label-tab">Preview</span>
        <div class="preview-wrap">
          <iframe id="outputPreview" title="Output preview" sandbox="allow-same-origin"></iframe>
        </div>
      </div>
    </div>
    <div class="actions" style="margin-top: 12px; margin-bottom: 0;">
      <button type="button" class="btn-secondary" id="btnCopy" disabled>Copy Result</button>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
    (function () {

      const inputEl = document.getElementById('input');
      const outputEl = document.getElementById('output');
      const inputPreviewEl = document.getElementById('inputPreview');
      const outputPreviewEl = document.getElementById('outputPreview');
      const btnClear = document.getElementById('btnClear');
      const btnCopy = document.getElementById('btnCopy');
      const keepTableStyleEl = document.getElementById('keepTableStyle');
      const toastEl = document.getElementById('toast');

      var inputPreviewTimer = null;

      var PREVIEW_PLACEHOLDER = '<!DOCTYPE html><html><head><meta charset="utf-8"></head><body style="margin:0;color:#999;font-size:13px;padding:8px;">Preview</body></html>';

      function setPreview(iframeEl, html) {
        if (!iframeEl) return;
        var raw = html ? html.trim() : '';
        if (!raw) {
          iframeEl.srcdoc = PREVIEW_PLACEHOLDER;
          return;
        }
        if (/^<!DOCTYPE/i.test(raw) || /^<html[\s>]/i.test(raw)) {
          iframeEl.srcdoc = raw;
        } else {
          iframeEl.srcdoc = '<!DOCTYPE html><html><head><meta charset="utf-8"></head><body style="margin:8px;">' + raw + '</body></html>';
        }
      }

      function updateInputPreview() {
        setPreview(inputPreviewEl, inputEl.value);
      }

      function updateOutputPreview() {
        setPreview(outputPreviewEl, outputEl.value);
      }

      function getOptions() {
        return {
          keepTableStyle: keepTableStyleEl.checked
        };
      }

      /** Hardcoded: remove empty <p>&nbsp;</p> and <div>&nbsp;</div> (and numeric/char forms). */
      function removeEmptyNbspNodes(html) {
        var list = [
          '<p>&nbsp;</p>', '<p>&#160;</p>', '<p>&#xA0;</p>',
          '<div>&nbsp;</div>', '<div>&#160;</div>', '<div>&#xA0;</div>'
        ];
        var s = html;
        for (var i = 0; i < list.length; i++) {
          while (s.indexOf(list[i]) !== -1) s = s.split(list[i]).join('');
        }
        return s;
      }

      /** Restore entity form: browser may serialize as raw Unicode, we want &ensp; etc. in output. */
      function restoreEntityForm(html) {
        return html
          .replace(/\u2002/g, '&ensp;')   /* en space */
          .replace(/\u2003/g, '&emsp;')   /* em space */
          .replace(/\u200C/g, '&zwnj;')   /* zero-width non-joiner */
          .replace(/\u200D/g, '&zwj;')    /* zero-width joiner */
          .replace(/\u2009/g, '&thinsp;'); /* thin space */
      }

      function sanitizeNode(root, options) {
        const dangerousTags = ['SCRIPT', 'STYLE', 'IFRAME', 'META', 'LINK'];
        const semanticTags = [
          'STRONG', 'EM', 'B', 'I',
          'H1', 'H2', 'H3', 'H4',
          'UL', 'OL', 'LI',
          'BLOCKQUOTE'
        ];
        const tableTags = ['TABLE', 'TR', 'TD', 'TH', 'TBODY', 'THEAD', 'TFOOT'];

        function walk(node) {
          if (node.nodeType === Node.COMMENT_NODE) return;

          if (node.nodeType === Node.ELEMENT_NODE) {
            if (dangerousTags.includes(node.tagName)) {
              node.remove();
              return;
            }

            if (tableTags.includes(node.tagName)) {
              [...node.attributes].forEach(attr => {
                const n = attr.name.toLowerCase();
                if (
                  n === 'colspan' || n === 'rowspan' || n === 'border' || n === 'width' ||
                  n.startsWith('data-') || n.startsWith('aria-')
                ) return;
                if (options.keepTableStyle && n === 'style') return;
                node.removeAttribute(n);
              });
            } else if (node.tagName === 'A') {
              [...node.attributes].forEach(attr => {
                const n = attr.name.toLowerCase();
                if (
                  n === 'href' || n === 'target' || n === 'rel' ||
                  n.startsWith('data-') || n.startsWith('aria-')
                ) return;
                node.removeAttribute(n);
              });
            } else if (node.tagName === 'IMG') {
              [...node.attributes].forEach(attr => {
                const n = attr.name.toLowerCase();
                if (
                  n === 'src' || n === 'alt' || n === 'width' || n === 'height' ||
                  n === 'loading' || n === 'decoding' || n === 'referrerpolicy' ||
                  n.startsWith('data-') || n.startsWith('aria-')
                ) return;
                node.removeAttribute(n);
              });
            } else if (semanticTags.includes(node.tagName)) {
              [...node.attributes].forEach(attr => {
                const n = attr.name.toLowerCase();
                if (n.startsWith('data-') || n.startsWith('aria-')) return;
                node.removeAttribute(n);
              });
            } else {
              [...node.attributes].forEach(attr => {
                const n = attr.name.toLowerCase();
                if (n.startsWith('data-') || n.startsWith('aria-')) return;
                node.removeAttribute(n);
              });
            }
          }

          [...node.childNodes].forEach(walk);
        }

        walk(root);
      }

      function clearStyleFromHtml(htmlString, options) {
        if (!htmlString || !htmlString.trim()) return '';
        var container = document.createElement('div');
        container.innerHTML = htmlString.trim();
        sanitizeNode(container, options);
        var result = container.innerHTML;
        result = removeEmptyNbspNodes(result);
        result = restoreEntityForm(result);
        return result;
      }

      function showToast(message) {
        toastEl.textContent = message;
        toastEl.classList.add('show');
        clearTimeout(showToast._t);
        showToast._t = setTimeout(function () {
          toastEl.classList.remove('show');
        }, 2000);
      }

      function runClear() {
        const raw = inputEl.value;
        const result = clearStyleFromHtml(raw, getOptions());
        outputEl.value = result;
        updateOutputPreview();
        btnCopy.disabled = !result;
        if (result) showToast('Style cleared.');
      }

      function copyResult() {
        const text = outputEl.value;
        if (!text) return;
        navigator.clipboard.writeText(text).then(function () {
          showToast('Copied to clipboard.');
        }, function () {
          showToast('Copy failed.');
        });
      }

      inputEl.addEventListener('input', function () {
        clearTimeout(inputPreviewTimer);
        inputPreviewTimer = setTimeout(updateInputPreview, 200);
      });
      inputEl.addEventListener('paste', function () {
        setTimeout(updateInputPreview, 50);
      });

      btnClear.addEventListener('click', runClear);
      btnCopy.addEventListener('click', copyResult);

      setPreview(inputPreviewEl, '');
      setPreview(outputPreviewEl, '');
    })();
  </script>
</body>

</html>
